<tool id="extract_plots" name="Extract Plots from RDS" version="1.0.0">
    <description>Extract and save plots from RDS object to PDF</description>
    
    <requirements>
        <container type="docker">nciccbr/scworkflow:v1.0.2_79db6d0</container>
    </requirements>
    
    <command detect_errors="exit_code">
        <![CDATA[
        cp '$params_json' config_used.json &&
        Rscript --vanilla '$__tool_directory__/Extract_plots.R' '$params_json' 2>&1 | tee tool_stdout.txt
        ]]>
    </command>
    
    <configfiles>
        <configfile name="params_json">
{
    "input_rds": "${input_rds}"
}
        </configfile>
    </configfiles>
    
    <inputs>
        <!-- Required inputs -->
        <param name="input_rds" type="data" format="rds" label="Input RDS File" 
               help="RDS file containing a list object with plots to extract"/>
    </inputs>
    
    <outputs>
        <data name="plots_pdf" format="pdf" from_work_dir="plots.pdf" 
              label="Extracted Plots PDF" />
        
        <data name="stdout_log" format="txt" from_work_dir="tool_stdout.txt" 
              label="Extract Plots Log"/>
        
        <data name="config_json" format="json" from_work_dir="config_used.json" 
              label="Extract Plots Config"/>
    </outputs>
    
    <tests>
        <test>
            <param name="input_rds" value="test_plots_object.rds"/>
            <output name="plots_pdf" file="expected_plots.pdf" compare="sim_size"/>
        </test>
    </tests>
    
    <help>
        <![CDATA[
**Extract Plots Tool**

This tool extracts ggplot2 plots stored within an RDS object and saves them to a multi-page PDF file. It's designed to work with RDS files that contain a list structure with a "plots" element containing multiple plot objects.

**Overview:**
The tool reads an RDS file containing a structured object with plots, extracts all plots from the "plots" list element, and generates a multi-page PDF where each plot appears on a separate page.

**Input Requirements:**

Input RDS File:
An RDS file containing a list object with the following structure:
- The object should be a list containing a "plots" element
- The "plots" element should contain a list of ggplot2 plot objects
- Each plot object in the list will be rendered as a separate page in the output PDF

Expected RDS Structure:
```
object_list <- list(
    plots = list(
        plot1 = ggplot_object_1,
        plot2 = ggplot_object_2,
        plot3 = ggplot_object_3,
        ...
    ),
    other_data = ...
)
```

**Output:**

Extracted Plots PDF:
A multi-page PDF file containing all plots from the input RDS object
- Each plot appears on a separate page
- Plots maintain their original formatting and styling
- Pages are automatically sized to accommodate each plot

Additional Outputs:
- Tool Log: Contains execution details and any error messages
- Config JSON: The configuration file used for this run

**Process Details:**
1. Loads the RDS file using readRDS()
2. Extracts the "plots" list from the loaded object
3. Creates a PDF device for output
4. Iterates through each plot in the list
5. Prints each plot to the PDF (automatically creates new pages)
6. Closes the PDF device

**Use Cases:**
- Extract plots generated by single-cell analysis workflows
- Convert plot objects stored in R data structures to viewable PDFs
- Batch export of multiple related visualizations
- Archive plots for later review or publication

**Requirements:**
- Input RDS must contain a list with a "plots" element
- Plots should be valid ggplot2 objects or other printable plot objects
- Sufficient system memory to load the RDS file and render plots

**Note:**
This tool is specifically designed for RDS objects created by scRNA-seq analysis workflows that store multiple plots in a standardized list structure.
        ]]>
    </help>
</tool>
